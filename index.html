<!DOCTYPE html>
<html>
  <head>
    <title>Angular</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.0-beta.2/angular-resource.min.js"></script>
    <script>
      (function() {
        angular
          .module("app", [
            "ui.router"
          ])
          .config([
            "$stateProvider",
            RouterFunction
          ])
          .controller("GrumbleIndexController", GrumbleIndexControllerFunc)
          .controller("GrumbleShowController", GrumbleShowControllerFunc)

        function RouterFunction($stateProvider) {
          $stateProvider
            .state("grumbleIndex", {
              url: "/grumbles",
              templateUrl: "js/index.html",
              controller: "GrumbleIndexController",
              controllerAs: "indexVm"
            })
            .state("grumbleShow", {
              url: "/grumbles/:id",
              templateUrl: "js/show.html",
              controller: "GrumbleShowController",
              controllerAs: "showVm"
            });
        }

        var grumbles = [
          {
            title: "I am Grumble One"
          },
          {
            title: "I'm another Grumble"
          }
        ]

        function GrumbleIndexControllerFunc($http) {
          var indexVm = this;
          indexVm.grumbles = grumbles;
          indexVm.newGrumble = "";

          indexVm.create = function(){
            grumbles.unshift({title: indexVm.newGrumble});
            indexVm.newGrumble = "";
          };

          indexVm.queryApi = function() {
            var url = "http://localhost:3000/grumbles"
            console.log(indexVm.grumbles);

            $http.get(url)
            .then(function(res) {
              res.data.forEach( function(item) {
                indexVm.grumbles.push(item);
              });
              console.log(indexVm.grumbles);
            })
          }
        }

        GrumbleShowControllerFunc.$inject = [ "$stateParams" ];
        function GrumbleShowControllerFunc($stateParams) {
          var showVm = this;
          showVm.grumble = grumbles[$stateParams.id].title;

          showVm.update = function() {
            grumbles[$stateParams.id].title = showVm.grumble;
          };

          showVm.delete = function() {
            grumbles.splice( $stateParams.id, 1 );
          }
        };

      })();
    </script>
  </head>
  <body data-ng-app="app">
    <h1>Grumblr</h1>
    <a data-ui-sref="grumbleIndex">Grumbles Index</a>
    <a data-ui-sref="grumbleShow">Grumbles Show</a>
    <div data-ui-view></div>
  </body>
</html>
